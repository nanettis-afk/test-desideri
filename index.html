<!DOCTYPE html>
<html lang="it">
<script>
  const ENDPOINT   = "https://script.google.com/macros/s/AKfycbwQHHP7F2jrrMcuI5ZMwTX2H6C9bhsUJ0qPNG9GtL6RJyobVevcrCi9UaYlso4I2GkJ/exec";
  const SECRET_KEY = "Sara-Desideri-2025-key-87cA!x"; 
  <script>
  // METTI QUI IL TUO /exec (quello attivo)
  const ENDPOINT   = "https://script.google.com/macros/s/AKfycbwQHHP7F2jrrMcuI5ZMwTX2H6C9bhsUJ0qPNG9GtL6RJyobVevcrCi9UaYlso4I2GkJ/exec";
  // LA STESSA CHIAVE di Apps Script
  const SECRET_KEY = "Sara-Desideri-2025-key-87cA!x";
</script>
  async function sendToSheet(records){
  try{
    const survey_id = (crypto.randomUUID && crypto.randomUUID()) || String(Date.now());
    const enriched = records.map(r => ({ ...r, survey_id }));
    const url = `${ENDPOINT}?key=${encodeURIComponent(SECRET_KEY)}`;

    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(enriched)
    });
    const text = await res.text();
    console.log('POST ‚Üí', url);
    console.log('Body ‚Üí', enriched);
    console.log('Risposta ‚Üê', res.status, text);
  }catch(e){
    console.log('Invio a Sheet non riuscito:', e);
  }
}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test dei Desideri</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{ --bg:#0f0f1a; --card:#17172b; --text:#f7f7ff; --muted:#c8c8d9; --accent1:#ff6bd6; --accent2:#7bffb7; --accent3:#7ac7ff; --radius:20px; }
    *{box-sizing:border-box}
    body{margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,Arial; color:var(--text); background: radial-gradient(1200px 800px at 10% -10%, #1c1c33 0%, #0b0b14 60%), var(--bg);}
    .wrap{max-width:900px; margin:28px auto; padding:0 14px;}
    h1{font-weight:800; margin:0 0 8px;}
    .subtitle{color:var(--muted); margin:10px 0 16px}
    .section{background:#17172b; border:1px solid rgba(255,255,255,.12); border-radius:var(--radius); padding:16px; margin-bottom:16px}
    label{display:block; margin:10px 0 6px; font-weight:600}
    input,select{width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.2); background:#1a1a33; color:var(--text)}
    .row{display:grid; grid-template-columns:1fr; gap:12px}
    @media(min-width:720px){.row{grid-template-columns:repeat(2,1fr)}}
    .actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
    .btn{background:#1a1a33; border:1px solid rgba(255,255,255,.16); color:var(--text); padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:600}
    .primary{background: linear-gradient(135deg, var(--accent2), var(--accent3)); color:#082019; border:none}
    .error{color:#ffd36b; font-size:12px; margin-top:6px}
    .hidden{display:none}
    /* Test UI */
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); border-radius:var(--radius); padding:14px; display:flex; gap:10px; align-items:center; cursor:pointer;}
    .card input{display:none}
    .card.selected{outline: 3px solid rgba(123,255,183,.65);}
    .emoji{font-size:26px}
    .title{font-weight:600}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#21213b; border:1px solid rgba(255,255,255,.1); font-size:12px; color:var(--muted)}
    .qcard{background: #121228; border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); padding:14px; margin:10px 0}
    .qtitle{font-weight:600; margin-bottom:8px}
    .options{display:flex; gap:8px; flex-wrap:wrap}
    .btn.opt{background:#1a1a33; border:1px solid rgba(255,255,255,.16); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600}
    .btn.opt[data-active="true"]{background: linear-gradient(135deg, var(--accent1), var(--accent3)); color:#0d0d14;}
    .panel{background:#0f0f22; border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); padding:14px}
    .legend{display:flex; flex-wrap:wrap; gap:10px; color:var(--muted)}
    .tag{background:#1b1b33; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.1)}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Lingua in prima schermata -->
    <div class="section">
      <label for="language" id="label-language">Lingua</label>
      <select id="language">
        <option value="it">Italiano</option><option value="en">English</option><option value="fr">Fran√ßais</option>
        <option value="es">Espa√±ol</option><option value="de">Deutsch</option><option value="zh">‰∏≠Êñá</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      </select>
    </div>

    <h1 id="title">Test dei Desideri</h1>
    <div class="subtitle" id="intro-subtitle">Compila prima alcune informazioni sociodemografiche, poi accedi al test ‚ú®</div>

    <!-- Sociodemografico -->
    <div id="socioDemo" class="section">
      <div class="row">
        <div><label id="label-age" for="age">Et√†</label><input type="number" id="age" min="10" max="120" inputmode="numeric" pattern="[0-9]*"></div>
        <div>
          <label id="label-gender" for="gender">Genere</label>
          <select id="gender">
            <option value="female" data-i18n="gender.female">Donna</option>
            <option value="male" data-i18n="gender.male">Uomo</option>
            <option value="nb" data-i18n="gender.nb">Non binario</option>
            <option value="na" data-i18n="gender.na">Preferisco non rispondere</option>
          </select>
        </div>
        <div>
          <label id="label-education" for="education">Titolo di studio</label>
          <select id="education">
            <option value="elementary" data-i18n="edu.elementary">Elementari</option>
            <option value="middle" data-i18n="edu.middle">Medie</option>
            <option value="high" data-i18n="edu.high">Diploma</option>
            <option value="degree" data-i18n="edu.degree">Laurea</option>
            <option value="master" data-i18n="edu.master">Master/Dottorato</option>
            <option value="other" data-i18n="common.other">Altro</option>
          </select>
        </div>
        <div>
          <label id="label-job" for="job">Occupazione</label>
          <select id="job">
            <option value="student" data-i18n="job.student">Studente</option>
            <option value="unemployed" data-i18n="job.unemployed">Disoccupato</option>
            <option value="employee" data-i18n="job.employee">Lavoratore dipendente</option>
            <option value="self" data-i18n="job.self">Libero professionista</option>
            <option value="retired" data-i18n="job.retired">Pensionato</option>
            <option value="other" data-i18n="common.other">Altro</option>
          </select>
        </div>
        <div>
          <label id="label-status" for="status">Stato civile</label>
          <select id="status">
            <option value="single" data-i18n="status.single">Single</option>
            <option value="couple" data-i18n="status.couple">In coppia</option>
            <option value="married" data-i18n="status.married">Sposato/a</option>
            <option value="separated" data-i18n="status.separated">Separato/a</option>
            <option value="widowed" data-i18n="status.widowed">Vedovo/a</option>
          </select>
        </div>
        <div><label id="label-children" for="children">Numero di figli</label><input type="number" id="children" min="0" max="20" inputmode="numeric" pattern="[0-9]*"></div>
      </div>

      <label id="label-country" for="country" style="margin-top:10px;">Paese di residenza</label>
      <select id="country">
        <option value="IT">Italia</option><option value="FR">Francia</option><option value="DE">Germania</option>
        <option value="ES">Spagna</option><option value="GB">Regno Unito</option><option value="US">Stati Uniti</option>
        <option value="CN">Cina</option><option value="JP">Giappone</option><option value="BR">Brasile</option>
        <option value="AR">Argentina</option><option value="MX">Messico</option><option value="CA">Canada</option>
      </select>
      <div id="errorMsg" class="error"></div>

      <div class="actions">
        <button type="button" class="btn primary" id="startTest">Inizia il test</button>
      </div>
    </div>

    <!-- Test -->
    <div id="testSection" class="hidden">
      <div class="subtitle" id="phase-intro">Ora puoi iniziare a selezionare i tuoi desideri üåü</div>

      <div class="section">
        <div class="pill" id="phase1">Fase 1 ¬∑ Seleziona i desideri</div>
        <div class="grid" id="desireGrid"></div>
        <div class="actions">
          <button type="button" class="btn" id="clearSelection">Reset</button>
          <button type="button" class="btn primary" id="toQuestions">Continua ‚Üí</button>
        </div>
      </div>

      <div id="questions"></div>

      <div class="section" id="results" style="display:none">
        <div class="panel" style="margin-bottom:12px;">
          <canvas id="radar" height="420"></canvas>
        </div>
        <div class="panel">
          <div class="legend" id="legend"></div>
          <div class="actions" style="margin-top:12px;">
            <button type="button" class="btn" id="toggleMode">Mostra distanza (‚ÜîÔ∏é)</button>
            <button type="button" class="btn" id="downloadPNG">Scarica grafico</button>
          </div>
        </div>
      </div>

      <div class="subtitle" id="footer" style="margin-top:16px;">Nota: il punteggio √® una autovalutazione basata su 6 indicatori...</div>
    </div>
  </div>

<script>
let currentLang = 'it';
let selected = [];
let answers = {};
let radar, showDistance=false;

// I18N (UI+desideri+domande) ‚Äì le 6 lingue richieste
const I = {
  it:{ L:{language:"Lingua", title:"Test dei Desideri", intro:"Compila prima alcune informazioni sociodemografiche, poi accedi al test ‚ú®", age:"Et√†", gender:"Genere", education:"Titolo di studio", job:"Occupazione", status:"Stato civile", children:"Numero di figli", country:"Paese di residenza", start:"Inizia il test", phaseIntro:"Ora puoi iniziare a selezionare i tuoi desideri üåü", phase1:"Fase 1 ¬∑ Seleziona i desideri", reset:"Reset", cont:"Continua ‚Üí", toggle:"Mostra distanza (‚ÜîÔ∏é)", download:"Scarica grafico", see:"Vedi risultati ‚ú®", footer:"Nota: il punteggio √® una autovalutazione basata su 6 indicatori: chiarezza, azioni, risorse, supporto, ostacoli, controllo personale. Usalo come bussola, non come verdetto üòä", warn:"Per favore compila almeno et√†" }, G:{female:"Donna", male:"Uomo", nb:"Non binario", na:"Preferisco non rispondere"}, E:{elementary:"Elementari", middle:"Medie", high:"Diploma", degree:"Laurea", master:"Master/Dottorato"}, J:{student:"Studente", unemployed:"Disoccupato", employee:"Lavoratore dipendente", self:"Libero professionista", retired:"Pensionato"}, S:{single:"Single", couple:"In coppia", married:"Sposato/a", separated:"Separato/a", widowed:"Vedovo/a"}, D:["üíº Successo professionale/lavorativo","üöÄ Realizzare un grande progetto personale","üåç Contribuire a un cambiamento sociale","üíò Amore autentico e stabile","üë™ Relazioni familiari solide e armoniose","ü§ù Amicizie profonde e durature","üß† Benessere fisico e mentale","üè° Una casa accogliente/sicura","‚úàÔ∏è Viaggiare e scoprire il mondo","üé≠ Espressione creativa/artistica","üí∂ Stabilit√† economica/finanziaria","üß≠ Libert√† e indipendenza personale","‚ú® Crescita interiore/spiritualit√†","üèÜ Riconoscimento e realizzazione personale","üìñ Apprendimento e crescita culturale","üåÑ Vivere esperienze nuove e avventurose"], Q:[{k:'clarity',t:'Quanto √® CHIARO il desiderio (specifico e misurabile)?',o:['Per nulla','Poco','Abbastanza','Molto','Cristallino'],inv:false},{k:'actions',t:'Stai AGENDO gi√† ora per questo desiderio?',o:['No','Ogni tanto','1-2 azioni/mese','1-2 azioni/settimana','Azioni settimanali+'],inv:false},{k:'resources',t:'Hai RISORSE (tempo, competenze, denaro) sufficienti?',o:['Per nulla','Poche','Parziali','Quasi sufficienti','Sufficienti+'],inv:false},{k:'support',t:'Hai una RETE di supporto (persone/alleati)?',o:['Nessuna','Limitata','Qualche contatto','Buona rete','Rete forte'],inv:false},{k:'obstacles',t:'Gli OSTACOLI ti stanno frenando?',o:['Moltissimo','Molto','Qualche ostacolo','Pochi','Quasi zero'],inv:true},{k:'control',t:'Quanto DIPENDE DA TE (vs. fattori esterni)?',o:['Quasi nulla','Poco','Met√†','Molto','Quasi tutto'],inv:false}], R:{prob:"Probabilit√† di realizzazione", dist:"Distanza dal traguardo"} },
  en:{ L:{language:"Language", title:"Dreams Test", intro:"Fill in some sociodemographic info, then start the test ‚ú®", age:"Age", gender:"Gender", education:"Education", job:"Occupation", status:"Marital status", children:"Number of children", country:"Country of residence", start:"Start test", phaseIntro:"Now select your dreams üåü", phase1:"Step 1 ¬∑ Select your dreams", reset:"Reset", cont:"Continue ‚Üí", toggle:"Show distance (‚ÜîÔ∏é)", download:"Download chart", see:"See results ‚ú®", footer:"Note: the score is a self-assessment based on 6 indicators: clarity, actions, resources, support, obstacles, personal control. Use it as a compass, not a verdict üòä", warn:"Please enter at least your age" }, G:{female:"Woman", male:"Man", nb:"Non-binary", na:"Prefer not to answer"}, E:{elementary:"Primary school", middle:"Middle school", high:"High school", degree:"Bachelor's degree", master:"Master/PhD"}, J:{student:"Student", unemployed:"Unemployed", employee:"Employee", self:"Self-employed", retired:"Retired"}, S:{single:"Single", couple:"In a relationship", married:"Married", separated:"Separated", widowed:"Widowed"}, D:["üíº Professional success","üöÄ Accomplish a major personal project","üåç Contribute to social change","üíò Authentic and stable love","üë™ Strong and harmonious family relationships","ü§ù Deep and lasting friendships","üß† Physical & mental wellbeing","üè° A cozy/safe home","‚úàÔ∏è Travel and explore the world","üé≠ Creative/artistic expression","üí∂ Financial stability","üß≠ Freedom and personal independence","‚ú® Inner growth/spirituality","üèÜ Recognition and self‚Äërealization","üìñ Learning and cultural growth","üåÑ New and adventurous experiences"], Q:[{k:'clarity',t:'How CLEAR is the dream (specific & measurable)?',o:['Not at all','A little','Somewhat','Very','Crystal clear'],inv:false},{k:'actions',t:'Are you ACTING on this dream already?',o:['No','Sometimes','1‚Äì2 actions/month','1‚Äì2 actions/week','Weekly+ actions'],inv:false},{k:'resources',t:'Do you have enough RESOURCES (time, skills, money)?',o:['Not at all','Few','Partial','Almost enough','Enough+'],inv:false},{k:'support',t:'Do you have a SUPPORT network (people/allies)?',o:['None','Limited','Some contacts','Good network','Strong network'],inv:false},{k:'obstacles',t:'Are OBSTACLES holding you back?',o:['Very much','A lot','Some','Few','Almost none'],inv:true},{k:'control',t:'How much depends on YOU (vs external factors)?',o:['Almost nothing','Little','Half','A lot','Almost all'],inv:false}], R:{prob:"Likelihood", dist:"Distance to goal"} },
  fr:{ L:{language:"Langue", title:"Test des D√©sirs", intro:"Renseignez d'abord quelques infos, puis commencez ‚ú®", age:"√Çge", gender:"Genre", education:"√âtudes", job:"Occupation", status:"√âtat civil", children:"Nombre d‚Äôenfants", country:"Pays de r√©sidence", start:"Commencer", phaseIntro:"S√©lectionnez vos d√©sirs üåü", phase1:"√âtape 1 ¬∑ S√©lectionnez vos d√©sirs", reset:"R√©initialiser", cont:"Continuer ‚Üí", toggle:"Afficher la distance (‚ÜîÔ∏é)", download:"T√©l√©charger le graphique", see:"Voir les r√©sultats ‚ú®", footer:"Auto√©valuation bas√©e sur 6 indicateurs : clart√©, actions, ressources, soutien, obstacles, contr√¥le personnel. Boussole, pas verdict üòä", warn:"Indiquez au moins votre √¢ge" }, G:{female:"Femme", male:"Homme", nb:"Non binaire", na:"Je pr√©f√®re ne pas r√©pondre"}, E:{elementary:"Primaire", middle:"Coll√®ge", high:"Lyc√©e", degree:"Licence", master:"Master/Doctorat"}, J:{student:"√âtudiant", unemployed:"Sans emploi", employee:"Employ√©", self:"Ind√©pendant", retired:"Retrait√©"}, S:{single:"C√©libataire", couple:"En couple", married:"Mari√©(e)", separated:"S√©par√©(e)", widowed:"Veuf/Veuve"}, D:["üíº R√©ussite professionnelle","üöÄ Mener un grand projet personnel","üåç Contribuer au changement social","üíò Amour authentique et stable","üë™ Relations familiales harmonieuses","ü§ù Amiti√©s profondes et durables","üß† Bien‚Äë√™tre physique et mental","üè° Un foyer s√ªr et chaleureux","‚úàÔ∏è Voyager et d√©couvrir le monde","üé≠ Expression cr√©ative/artistique","üí∂ Stabilit√© financi√®re","üß≠ Libert√© et ind√©pendance personnelle","‚ú® Croissance int√©rieure/spiritualit√©","üèÜ Reconnaissance et accomplissement","üìñ Apprentissage et culture","üåÑ Vivre de nouvelles aventures"], Q:[{k:'clarity',t:'Ce d√©sir est‚Äëil CLAIR (sp√©cifique & mesurable) ?',o:['Pas du tout','Peu','Assez','Beaucoup','Cristallin'],inv:false},{k:'actions',t:'Agissez‚Äëvous d√©j√† ?',o:['Non','Parfois','1‚Äì2 actions/mois','1‚Äì2 actions/semaine','Hebdo+'],inv:false},{k:'resources',t:'Avez‚Äëvous des RESSOURCES suffisantes ?',o:['Pas du tout','Peu','Partielles','Presque suffisantes','Suffisantes+'],inv:false},{k:'support',t:'Avez‚Äëvous un R√âSEAU de soutien ?',o:['Aucun','Limit√©','Quelques contacts','Bon r√©seau','R√©seau fort'],inv:false},{k:'obstacles',t:'Les OBSTACLES vous freinent‚Äëils ?',o:['√ânorm√©ment','Beaucoup','Un peu','Peu','Presque pas'],inv:true},{k:'control',t:'Quelle part d√©pend de VOUS ?',o:['Presque rien','Peu','Moiti√©','Beaucoup','Presque tout'],inv:false}], R:{prob:"Probabilit√©", dist:"Distance"} },
  es:{ L:{language:"Idioma", title:"Test de los Deseos", intro:"Completa primero algunos datos y empieza ‚ú®", age:"Edad", gender:"G√©nero", education:"Educaci√≥n", job:"Ocupaci√≥n", status:"Estado civil", children:"N√∫mero de hijos", country:"Pa√≠s de residencia", start:"Empezar", phaseIntro:"Ahora selecciona tus deseos üåü", phase1:"Paso 1 ¬∑ Selecciona tus deseos", reset:"Reiniciar", cont:"Continuar ‚Üí", toggle:"Mostrar distancia (‚ÜîÔ∏é)", download:"Descargar gr√°fico", see:"Ver resultados ‚ú®", footer:"Autoevaluaci√≥n basada en 6 indicadores: claridad, acciones, recursos, apoyo, obst√°culos, control personal. Br√∫jula, no veredicto üòä", warn:"Indica al menos tu edad" }, G:{female:"Mujer", male:"Hombre", nb:"No binario", na:"Prefiero no responder"}, E:{elementary:"Primaria", middle:"Secundaria b√°sica", high:"Bachillerato", degree:"Grado", master:"M√°ster/Doctorado"}, J:{student:"Estudiante", unemployed:"Desempleado", employee:"Empleado", self:"Aut√≥nomo", retired:"Jubilado"}, S:{single:"Soltero/a", couple:"En pareja", married:"Casado/a", separated:"Separado/a", widowed:"Viudo/a"}, D:["üíº √âxito profesional","üöÄ Realizar un gran proyecto personal","üåç Contribuir al cambio social","üíò Amor aut√©ntico y estable","üë™ Relaciones familiares s√≥lidas","ü§ù Amistades profundas y duraderas","üß† Bienestar f√≠sico y mental","üè° Un hogar seguro y acogedor","‚úàÔ∏è Viajar y explorar el mundo","üé≠ Expresi√≥n creativa/art√≠stica","üí∂ Estabilidad financiera","üß≠ Libertad e independencia personal","‚ú® Crecimiento interior/espiritualidad","üèÜ Reconocimiento y autorrealizaci√≥n","üìñ Aprendizaje y crecimiento cultural","üåÑ Nuevas experiencias aventureras"], Q:[{k:'clarity',t:'¬øQu√© tan CLARO es el deseo (espec√≠fico y medible)?',o:['Nada','Poco','Algo','Mucho','Clar√≠simo'],inv:false},{k:'actions',t:'¬øYa est√°s ACTUANDO en este deseo?',o:['No','A veces','1‚Äì2/mes','1‚Äì2/semana','Semanal+'],inv:false},{k:'resources',t:'¬øTienes RECURSOS suficientes?',o:['Nada','Pocos','Parciales','Casi suficientes','Suficientes+'],inv:false},{k:'support',t:'¬øTienes una RED de apoyo?',o:['Ninguna','Limitada','Algunos contactos','Buena red','Red fuerte'],inv:false},{k:'obstacles',t:'¬øLos OBST√ÅCULOS te frenan?',o:['Much√≠simo','Mucho','Algo','Poco','Casi nada'],inv:true},{k:'control',t:'¬øCu√°nto depende de TI?',o:['Casi nada','Poco','La mitad','Mucho','Casi todo'],inv:false}], R:{prob:"Probabilidad", dist:"Distancia"} },
  de:{ L:{language:"Sprache", title:"Wunschtest", intro:"Zuerst ein paar Angaben, dann los ‚ú®", age:"Alter", gender:"Geschlecht", education:"Bildung", job:"Besch√§ftigung", status:"Familienstand", children:"Anzahl der Kinder", country:"Wohnsitzland", start:"Test starten", phaseIntro:"W√§hle deine W√ºnsche üåü", phase1:"Schritt 1 ¬∑ W√§hle deine W√ºnsche", reset:"Zur√ºcksetzen", cont:"Weiter ‚Üí", toggle:"Distanz anzeigen (‚ÜîÔ∏é)", download:"Diagramm herunterladen", see:"Ergebnisse anzeigen ‚ú®", footer:"Selbsteinsch√§tzung auf Basis von 6 Indikatoren ... Kompass, kein Urteil üòä", warn:"Bitte gib mindestens dein Alter an" }, G:{female:"Frau", male:"Mann", nb:"Nicht-bin√§r", na:"Keine Angabe"}, E:{elementary:"Grundschule", middle:"Mittelschule", high:"Abitur", degree:"Bachelor", master:"Master/Promotion"}, J:{student:"Student", unemployed:"Arbeitslos", employee:"Angestellt", self:"Selbstst√§ndig", retired:"Ruhestand"}, S:{single:"Ledig", couple:"In Beziehung", married:"Verheiratet", separated:"Getrennt", widowed:"Verwitwet"}, D:["üíº Beruflicher Erfolg","üöÄ Gro√ües pers√∂nliches Projekt","üåç Gesellschaftlichen Wandel unterst√ºtzen","üíò Authentische, stabile Liebe","üë™ Starke Familienbeziehungen","ü§ù Tiefe Freundschaften","üß† K√∂rperliches & mentales Wohlbefinden","üè° Ein sicheres Zuhause","‚úàÔ∏è Reisen & die Welt entdecken","üé≠ Kreative/k√ºnstlerische Entfaltung","üí∂ Finanzielle Stabilit√§t","üß≠ Freiheit & pers√∂nliche Unabh√§ngigkeit","‚ú® Innere Entwicklung/Spiritualit√§t","üèÜ Anerkennung & Selbstverwirklichung","üìñ Lernen & kulturelles Wachstum","üåÑ Neue, abenteuerliche Erfahrungen"], Q:[{k:'clarity',t:'Wie KLAR ist der Wunsch (spezifisch & messbar)?',o:['Gar nicht','Wenig','Etwas','Sehr','Kristallklar'],inv:false},{k:'actions',t:'Arbeitest du bereits daran?',o:['Nein','Manchmal','1‚Äì2/Monat','1‚Äì2/Woche','W√∂chentlich+'],inv:false},{k:'resources',t:'Hast du gen√ºgend RESSOURCEN?',o:['Gar nicht','Wenig','Teilweise','Fast genug','Genug+'],inv:false},{k:'support',t:'Hast du ein UNTERST√úTZUNGSnetz?',o:['Keins','Begrenzt','Einige Kontakte','Gutes Netz','Starkes Netz'],inv:false},{k:'obstacles',t:'Halten dich HINDERNISSE auf?',o:['Sehr','Stark','Etwas','Wenig','Kaum'],inv:true},{k:'control',t:'Wieviel h√§ngt von DIR ab?',o:['Fast nichts','Wenig','Zur H√§lfte','Viel','Fast alles'],inv:false}], R:{prob:"Wahrscheinlichkeit", dist:"Distanz"} },
  zh:{ L:{language:"ËØ≠Ë®Ä", title:"ÊÑøÊúõÊµãËØï", intro:"ÂÖàÂ°´ÂÜô‰∏Ä‰∫õ‰ø°ÊÅØÔºåÁÑ∂ÂêéÂºÄÂßãÊµãËØï ‚ú®", age:"Âπ¥ÈæÑ", gender:"ÊÄßÂà´", education:"ÊïôËÇ≤Á®ãÂ∫¶", job:"ËÅå‰∏ö", status:"Â©öÂßªÁä∂ÂÜµ", children:"Â≠êÂ•≥Êï∞Èáè", country:"Â±Ö‰ΩèÂõΩÂÆ∂", start:"ÂºÄÂßãÊµãËØï", phaseIntro:"Áé∞Âú®ÈÄâÊã©‰Ω†ÁöÑÊÑøÊúõ üåü", phase1:"Ê≠•È™§ 1 ¬∑ ÈÄâÊã©‰Ω†ÁöÑÊÑøÊúõ", reset:"ÈáçÁΩÆ", cont:"ÁªßÁª≠ ‚Üí", toggle:"ÊòæÁ§∫Ë∑ùÁ¶ª (‚ÜîÔ∏é)", download:"‰∏ãËΩΩÂõæË°®", see:"Êü•ÁúãÁªìÊûú ‚ú®", footer:"ËøôÊòØÂü∫‰∫é6‰∏™ÊåáÊ†áÁöÑËá™ÊàëËØÑ‰º∞‚Ä¶ üòä", warn:"ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÂπ¥ÈæÑ" }, G:{female:"Â•≥ÊÄß", male:"Áî∑ÊÄß", nb:"Èùû‰∫åÂÖÉ", na:"‰∏çÊÑøÂõûÁ≠î"}, E:{elementary:"Â∞èÂ≠¶", middle:"Âàù‰∏≠", high:"È´ò‰∏≠", degree:"Êú¨Áßë", master:"Á°ïÂ£´/ÂçöÂ£´"}, J:{student:"Â≠¶Áîü", unemployed:"Â§±‰∏ö", employee:"ÈõáÂëò", self:"Ëá™Áî±ËÅå‰∏ö", retired:"ÈÄÄ‰ºë"}, S:{single:"ÂçïË∫´", couple:"ÊÅãÁà±‰∏≠", married:"Â∑≤Â©ö", separated:"ÂàÜÂ±Ö", widowed:"‰∏ßÂÅ∂"}, D:["üíº ËÅå‰∏öÊàêÂäü","üöÄ ÈáçË¶Å‰∏™‰∫∫È°πÁõÆ","üåç Á§æ‰ºöÂèòÈù©Ë¥°ÁåÆ","üíò ÁúüÂÆûÁ®≥ÂÆöÁöÑÁà±","üë™ ÂíåË∞êÁöÑÂÆ∂Â∫≠ÂÖ≥Á≥ª","ü§ù Ê∑±ÂéöÊåÅ‰πÖÁöÑÂèãË∞ä","üß† Ë∫´ÂøÉÂÅ•Â∫∑","üè° ÂÆâÂÖ®ËàíÈÄÇÁöÑÂÆ∂","‚úàÔ∏è ÊóÖË°åÊé¢Á¥¢‰∏ñÁïå","üé≠ ÂàõÊÑè/Ëâ∫ÊúØË°®Ëææ","üí∂ Ë¥¢Âä°Á®≥ÂÆö","üß≠ Ëá™Áî±‰∏éÁã¨Á´ã","‚ú® ÂÜÖÂú®ÊàêÈïø/ÁÅµÊÄß","üèÜ ËÆ§ÂèØ‰∏éËá™ÊàëÂÆûÁé∞","üìñ Â≠¶‰π†‰∏éÊñáÂåñÊàêÈïø","üåÑ ÂÜíÈô©Êñ∞‰ΩìÈ™å"], Q:[{k:'clarity',t:'ÊÑøÊúõÊòØÂê¶Ê∏ÖÊô∞ÔºàÂÖ∑‰Ωì‰∏îÂèØË°°ÈáèÔºâÔºü',o:['ÂÆåÂÖ®‰∏ç','ÊúâÁÇπ','‰∏ÄËà¨','ÂæàÊ∏ÖÊô∞','ÈùûÂ∏∏Ê∏ÖÊô∞'],inv:false},{k:'actions',t:'‰Ω†ÊòØÂê¶Â∑≤ÁªèÂú®‰∏∫Ê≠§Ë°åÂä®Ôºü',o:['Ê≤°Êúâ','ÂÅ∂Â∞î','ÊØèÊúà1‚Äì2Ê¨°','ÊØèÂë®1‚Äì2Ê¨°','ÊØèÂë®Â§öÊ¨°'],inv:false},{k:'resources',t:'ËµÑÊ∫êÊòØÂê¶ÂÖÖË∂≥Ôºü',o:['ÂÆåÂÖ®‰∏ç','ËæÉÂ∞ë','ÈÉ®ÂàÜ','Êé•ËøëË∂≥Â§ü','Ë∂≥Â§ü+'],inv:false},{k:'support',t:'ÊòØÂê¶ÊúâÊîØÊåÅÁΩëÁªúÔºü',o:['Ê≤°Êúâ','ÊúâÈôê','‰∏Ä‰∫õ','ËâØÂ•Ω','Âº∫Â§ß'],inv:false},{k:'obstacles',t:'ÈöúÁ¢çÊòØÂê¶ÈòªÁ¢ç‰Ω†Ôºü',o:['ÈùûÂ∏∏Â§ö','ÂæàÂ§ö','‰∏Ä‰∫õ','ËæÉÂ∞ë','Âá†‰πéÊ≤°Êúâ'],inv:true},{k:'control',t:'ÊúâÂ§öÂ∞ëÂèñÂÜ≥‰∫é‰Ω†Ôºü',o:['Âá†‰πéÊ≤°Êúâ','ÂæàÂ∞ë','‰∏ÄÂçä','ÂæàÂ§ö','Âá†‰πéÂÖ®ÈÉ®'],inv:false}], R:{prob:"ÂÆûÁé∞Ê¶ÇÁéá", dist:"Ë∑ùÁ¶ªÁõÆÊ†á"} },
  ar:{ L:{language:"ÿßŸÑŸÑÿ∫ÿ©", title:"ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ŸÖŸÜŸäÿßÿ™", intro:"ÿßŸÖŸÑÿ£ ÿ®ÿπÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ´ŸÖ ÿßÿ®ÿØÿ£ ‚ú®", age:"ÿßŸÑÿπŸÖÿ±", gender:"ÿßŸÑŸÜŸàÿπ", education:"ÿßŸÑÿ™ÿπŸÑŸäŸÖ", job:"ÿßŸÑÿπŸÖŸÑ", status:"ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸäÿ©", children:"ÿπÿØÿØ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ", country:"ÿ®ŸÑÿØ ÿßŸÑÿ•ŸÇÿßŸÖÿ©", start:"ÿßÿ®ÿØÿ£ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±", phaseIntro:"ÿßÿÆÿ™ÿ± ÿ£ŸÖŸÜŸäÿßÿ™ŸÉ ÿßŸÑÿ¢ŸÜ üåü", phase1:"ÿßŸÑÿÆÿ∑Ÿàÿ© 1 ¬∑ ÿßÿÆÿ™ÿ± ÿ£ŸÖŸÜŸäÿßÿ™ŸÉ", reset:"ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ", cont:"ŸÖÿ™ÿßÿ®ÿπÿ© ‚Üí", toggle:"ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖÿ≥ÿßŸÅÿ© (‚ÜîÔ∏é)", download:"ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑÿ±ÿ≥ŸÖ", see:"ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ‚ú®", footer:"ÿ™ŸÇŸäŸäŸÖ ÿ∞ÿßÿ™Ÿä ŸÖÿ®ŸÜŸä ÿπŸÑŸâ 6 ŸÖÿ§ÿ¥ÿ±ÿßÿ™‚Ä¶ üòä", warn:"ŸäŸèÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿπŸÖÿ±" }, G:{female:"ÿßŸÖÿ±ÿ£ÿ©", male:"ÿ±ÿ¨ŸÑ", nb:"ÿ∫Ÿäÿ± ÿ´ŸÜÿßÿ¶Ÿä", na:"ÿ£ŸÅÿ∂ŸÑ ÿπÿØŸÖ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©"}, E:{elementary:"ÿßÿ®ÿ™ÿØÿßÿ¶Ÿä", middle:"ÿ•ÿπÿØÿßÿØŸä", high:"ÿ´ÿßŸÜŸàŸä", degree:"ÿ®ŸÉÿßŸÑŸàÿ±ŸäŸàÿ≥", master:"ŸÖÿßÿ¨ÿ≥ÿ™Ÿäÿ±/ÿØŸÉÿ™Ÿàÿ±ÿßŸá"}, J:{student:"ÿ∑ÿßŸÑÿ®", unemployed:"ÿπÿßÿ∑ŸÑ", employee:"ŸÖŸàÿ∏ŸÅ", self:"ÿπŸÖŸÑ ÿ≠ÿ±", retired:"ŸÖÿ™ŸÇÿßÿπÿØ"}, S:{single:"ÿ£ÿπÿ≤ÿ®", couple:"ŸÖÿ±ÿ™ÿ®ÿ∑", married:"ŸÖÿ™ÿ≤Ÿàÿ¨", separated:"ŸÖŸÜŸÅÿµŸÑ", widowed:"ÿ£ÿ±ŸÖŸÑ"}, D:["üíº ŸÜÿ¨ÿßÿ≠ ŸÖŸáŸÜŸä","üöÄ ŸÖÿ¥ÿ±Ÿàÿπ ÿ¥ÿÆÿµŸä ŸÉÿ®Ÿäÿ±","üåç ÿßŸÑŸÖÿ≥ÿßŸáŸÖÿ© ŸÅŸä ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸä","üíò ÿ≠ÿ® ÿ£ÿµŸäŸÑ ŸàŸÖÿ≥ÿ™ŸÇÿ±","üë™ ÿπŸÑÿßŸÇÿßÿ™ ÿ£ÿ≥ÿ±Ÿäÿ© ŸÖÿ™ŸäŸÜÿ©","ü§ù ÿµÿØÿßŸÇÿßÿ™ ÿπŸÖŸäŸÇÿ© ŸàÿØÿßÿ¶ŸÖÿ©","üß† ÿµÿ≠ÿ© ŸÜŸÅÿ≥Ÿäÿ© Ÿàÿ¨ÿ≥ÿØŸäÿ©","üè° ŸÖŸÜÿ≤ŸÑ ÿ¢ŸÖŸÜ ŸàÿØÿßŸÅÿ¶","‚úàÔ∏è ÿßŸÑÿ≥ŸÅÿ± Ÿàÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑÿπÿßŸÑŸÖ","üé≠ ÿ™ÿπÿ®Ÿäÿ± ÿ•ÿ®ÿØÿßÿπŸä/ŸÅŸÜŸä","üí∂ ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ± ŸÖÿßŸÑŸä","üß≠ ÿ≠ÿ±Ÿäÿ© Ÿàÿßÿ≥ÿ™ŸÇŸÑÿßŸÑ ÿ¥ÿÆÿµŸä","‚ú® ŸÜŸÖŸà ÿØÿßÿÆŸÑŸä/ÿ±Ÿàÿ≠ÿßŸÜŸä","üèÜ ÿßÿπÿ™ÿ±ÿßŸÅ Ÿàÿ™ÿ≠ŸÇŸäŸÇ ÿ∞ÿßÿ™","üìñ ÿ™ÿπŸÑŸÖ ŸàŸÜŸÖŸà ÿ´ŸÇÿßŸÅŸä","üåÑ ÿ™ÿ¨ÿßÿ±ÿ® ÿ¨ÿØŸäÿØÿ© ŸàŸÖÿ∫ÿßŸÖÿ±ÿ©"], Q:[{k:'clarity',t:'ŸÖÿß ŸÖÿØŸâ Ÿàÿ∂Ÿàÿ≠ ÿßŸÑÿ£ŸÖŸÜŸäÿ©ÿü',o:['ŸÑÿß ÿ¥Ÿäÿ°','ŸÇŸÑŸäŸÑ','ŸÖÿ™Ÿàÿ≥ÿ∑','ŸÉÿ®Ÿäÿ±','Ÿàÿßÿ∂ÿ≠ ÿ¨ÿØŸãÿß'],inv:false},{k:'actions',t:'ŸáŸÑ ÿ™ÿπŸÖŸÑ ÿπŸÑŸâ Ÿáÿ∞Ÿá ÿßŸÑÿ£ŸÖŸÜŸäÿ©ÿü',o:['ŸÑÿß','ÿ£ÿ≠ŸäÿßŸÜŸãÿß','1‚Äì2/ÿ¥Ÿáÿ±','1‚Äì2/ÿ£ÿ≥ÿ®Ÿàÿπ','ÿ£ÿ≥ÿ®ŸàÿπŸäŸãÿß+'],inv:false},{k:'resources',t:'ŸáŸÑ ÿßŸÑŸÖŸàÿßÿ±ÿØ ŸÉÿßŸÅŸäÿ©ÿü',o:['ŸÑÿß','ŸÇŸÑŸäŸÑ','ÿ¨ÿ≤ÿ¶Ÿä','ŸäŸÉÿßÿØ ŸäŸÉŸÅŸä','ŸäŸÉŸÅŸä+'],inv:false},{k:'support',t:'ŸáŸÑ ŸÑÿØŸäŸÉ ÿ¥ÿ®ŸÉÿ© ÿØÿπŸÖÿü',o:['ŸÑÿß','ŸÖÿ≠ÿØŸàÿØÿ©','ÿ®ÿπÿ∂ ÿßŸÑÿßÿ™ÿµÿßŸÑÿßÿ™','ÿ¥ÿ®ŸÉÿ© ÿ¨ŸäÿØÿ©','ÿ¥ÿ®ŸÉÿ© ŸÇŸàŸäÿ©'],inv:false},{k:'obstacles',t:'ŸáŸÑ ÿßŸÑÿπŸàÿßÿ¶ŸÇ ÿ™ÿπÿ±ŸÇŸÑ ÿ™ŸÇÿØŸÖŸÉÿü',o:['ÿ¨ÿØÿßŸã','ŸÉÿ´Ÿäÿ±ÿßŸã','ÿ®ÿπÿ∂ ÿßŸÑÿ¥Ÿäÿ°','ŸÇŸÑŸäŸÑ','ÿ™ŸÇÿ±Ÿäÿ®Ÿãÿß ŸÑÿß'],inv:true},{k:'control',t:'ŸÉŸÖ Ÿäÿπÿ™ŸÖÿØ ÿßŸÑÿ£ŸÖÿ± ÿπŸÑŸäŸÉÿü',o:['ÿ™ŸÇÿ±Ÿäÿ®Ÿãÿß ŸÑÿß','ŸÇŸÑŸäŸÑ','ÿßŸÑŸÜÿµŸÅ','ŸÉÿ´Ÿäÿ±','ÿ™ŸÇÿ±Ÿäÿ®Ÿãÿß ŸÉŸÑ ÿ¥Ÿäÿ°'],inv:false}], R:{prob:"ÿßŸÑÿßÿ≠ÿ™ŸÖÿßŸÑ", dist:"ÿßŸÑŸÖÿ≥ÿßŸÅÿ©"} }
};

const KEYS = ['lavoro','progetto','impatto','amore','famiglia','amici','benessere','casa','viaggi','arte','soldi','indipendenza','spiritualita','riconoscimento','conoscenza','avventura'];

function t(){ return I[currentLang]; }

// Apply language to all UI
function applyLang(){
  document.documentElement.lang = currentLang;
  const L = t().L;
  // labels
  document.getElementById('label-language').innerText = L.language;
  document.getElementById('title').innerText = L.title;
  document.getElementById('intro-subtitle').innerText = L.intro;
  document.getElementById('label-age').innerText = L.age;
  document.getElementById('label-gender').innerText = L.gender;
  document.getElementById('label-education').innerText = L.education;
  document.getElementById('label-job').innerText = L.job;
  document.getElementById('label-status').innerText = L.status;
  document.getElementById('label-children').innerText = L.children;
  document.getElementById('label-country').innerText = L.country;
  document.getElementById('startTest').innerText = L.start;
  document.getElementById('phase-intro').innerText = L.phaseIntro;
  document.getElementById('phase1').innerText = L.phase1;
  document.getElementById('clearSelection').innerText = L.reset;
  document.getElementById('toQuestions').innerText = L.cont;
  document.getElementById('toggleMode').innerText = L.toggle;
  document.getElementById('downloadPNG').innerText = L.download;
  document.getElementById('footer').innerText = L.footer;

  // translate dropdown options with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const path = el.getAttribute('data-i18n').split('.'); // e.g. gender.female
    let node = I[currentLang];
    for(const p of path){ node = node && node[p]; }
    if(node){ el.textContent = node; }
  });

  // rebuild desires grid
  buildDesires();
  // if questions already visible, rebuild them in new language
  if (document.getElementById('questions').children.length) renderQuestions();
}

function buildDesires(){
  const grid = document.getElementById('desireGrid');
  grid.innerHTML = '';
  t().D.forEach((label, idx)=> addCard(grid, KEYS[idx], label));
  selected = []; // reset selection to avoid mismatches across languages
  answers = {};
  document.getElementById('questions').innerHTML='';
  document.getElementById('results').style.display='none';
}

function addCard(parent, key, label){
  const card = document.createElement('label');
  card.className = 'card';
  card.innerHTML = `<input type="checkbox" data-key="${key}"><div class="emoji">${label.split(' ')[0]}</div><div class="title">${label.substring(2)}</div>`;
  parent.appendChild(card);
  const input = card.querySelector('input');
  input.addEventListener('change', (e) => {
    if (e.target.checked) {
      if (selected.length >= 8) { e.target.checked = false; return; }
      selected.push(key); card.classList.add('selected');
    } else { selected = selected.filter(k => k!==key); card.classList.remove('selected'); }
  });
}

function renderQuestions(){
  const holder = document.getElementById('questions');
  holder.innerHTML = '';
  const Q = t().Q;

  selected.forEach((key,i)=>{
    const el = document.querySelector(`input[data-key="${key}"]`).parentElement;
    const label = el.querySelector('.emoji').textContent + ' ' + el.querySelector('.title').textContent;
    const block = document.createElement('div');
    block.className = 'qcard';
    block.innerHTML = `<div class="qtitle">${i+1}. ${label}</div>`;

    Q.forEach(q => {
      const row = document.createElement('div');
      row.style.margin = '10px 0 14px';
      row.innerHTML = `<div style="margin-bottom:6px; color:var(--muted)">${q.t}</div>`;
      const opts = document.createElement('div');
      opts.className = 'options';
      q.o.forEach((lab, idx)=>{
        const b = document.createElement('button');
        b.className = 'btn opt'; b.textContent = lab; b.setAttribute('data-active','false');
        b.onclick = ()=>{
          [...opts.children].forEach(el=>el.setAttribute('data-active','false'));
          b.setAttribute('data-active','true');
          if (!answers[key]) answers[key] = {};
          answers[key][q.k] = idx;
        };
        opts.appendChild(b);
      });
      row.appendChild(opts); block.appendChild(row);
    });

    holder.appendChild(block);
  });

  const go = document.createElement('div');
  go.className = 'actions';
  go.innerHTML = `<button type="button" class="btn primary" id="seeResults">${t().L.see}</button>`;
  holder.appendChild(go);
  document.getElementById('seeResults').onclick = computeAndShow;
}

function computeScoreFor(desireKey){
  const a = answers[desireKey] || {};
  const Q = t().Q;
  let sum = 0, max = 0;
  Q.forEach(q=>{
    const v = (a[q.k] ?? 0);
    const val = q.inv ? (4 - v) : v;
    sum += (val/4);
    max += 1;
  });
  const ratio = (max? sum/max : 0);
  return Math.round(ratio*100);
}

function computeAndShow(){
  const Q = t().Q;
  for(const k of selected){
    if(!answers[k] || Object.keys(answers[k]).length < Q.length){
      alert(t().L.warn);
      return;
    }
  }
  const labels = selected.map(k => {
    const el = document.querySelector(`input[data-key="${k}"]`).parentElement;
    return el.querySelector('.emoji').textContent + ' ' + el.querySelector('.title').textContent;
  });
  const scores = selected.map(k => computeScoreFor(k));
  const dataToPlot = showDistance ? scores.map(s=>100-s) : scores;

  const legend = document.getElementById('legend');
  legend.innerHTML = '';
  selected.forEach((k,i)=>{
    const chip = document.createElement('div');
    chip.className = 'tag';
    chip.textContent = `${labels[i]} ‚Üí ${showDistance? (100-scores[i]) : scores[i]}%`;
    legend.appendChild(chip);
  });

  document.getElementById('results').style.display = '';

  const ctx = document.getElementById('radar');
  if (radar) radar.destroy();
  radar = new Chart(ctx, {
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: showDistance? t().R.dist : t().R.prob,
        data: dataToPlot,
        fill: true,
        backgroundColor: 'rgba(123,255,183,0.25)',
        borderColor: 'rgba(122,199,255,1)',
        pointBackgroundColor: '#ffffff',
        pointBorderColor: 'rgba(255,255,255,.6)',
        pointRadius: 4,
        borderWidth: 3,
      }]
    },
    options: {
      responsive: true,
      scales: { r: { suggestedMin:0, suggestedMax:100, grid:{color:'rgba(255,255,255,.1)'}, angleLines:{color:'rgba(255,255,255,.15)'}, pointLabels:{color:'#eaeaf6', font:{size:12, weight:'600'}}, ticks:{display:true, color:'#bfbfdf', backdropColor:'transparent', stepSize:20} } },
      plugins: { legend:{ labels:{ color:'#eaeaf6' } } }
    }
  });
}

// Event wiring
document.getElementById('language').addEventListener('change', e=>{
  currentLang = e.target.value;
  applyLang();
});

document.getElementById('startTest').addEventListener('click', ()=>{
  const age = document.getElementById('age').value.trim();
  if(!age){
    document.getElementById('errorMsg').textContent = t().L.warn;
  } else {
    document.getElementById('errorMsg').textContent = '';
  }
  // Procede comunque al test anche se mancano campi, per evitare blocchi su mobile
  document.getElementById('socioDemo').classList.add('hidden');
  document.getElementById('testSection').classList.remove('hidden');
  window.scrollTo({top:0, behavior:'smooth'});
  applyLang(); // per assicurare traduzione anche nella schermata test
});

document.getElementById('clearSelection').addEventListener('click', ()=>{
  selected = []; answers = {};
  document.querySelectorAll('#desireGrid input').forEach(i=>{i.checked=false; i.closest('.card').classList.remove('selected');});
  document.getElementById('questions').innerHTML='';
  document.getElementById('results').style.display='none';
});

document.getElementById('toQuestions').addEventListener('click', ()=>{
  if (!selected.length) { alert(t().L.warn); return; }
  renderQuestions();
  window.scrollTo({top: document.getElementById('questions').offsetTop - 10, behavior:'smooth'});
});

document.getElementById('toggleMode').addEventListener('click', ()=>{
  showDistance = !showDistance;
  computeAndShow();
});

document.getElementById('downloadPNG').addEventListener('click', ()=>{
  const link = document.createElement('a');
  link.download = 'radar_desideri.png';
  link.href = document.getElementById('radar').toDataURL('image/png');
  link.click();
});

// Init
applyLang();
buildDesires();
</script>
</body>
</html>
