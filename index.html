<!DOCTYPE html>
<html lang="it">
<script>
  const ENDPOINT   = "https://script.google.com/macros/s/AKfycbyGgV0lRlamIMP46Fvuw1dD_dMbEh5ollwmYYFoMTTKssTpzWjdoP5SIayktk3dvI4U/exec";
  const SECRET_KEY = "Sara-Desideri-2025-key-87cA!x"; 
</script>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test dei Desideri</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{ --bg:#0f0f1a; --card:#17172b; --text:#f7f7ff; --muted:#c8c8d9; --accent1:#ff6bd6; --accent2:#7bffb7; --accent3:#7ac7ff; --radius:20px; }
    *{box-sizing:border-box}
    body{margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,Arial; color:var(--text); background: radial-gradient(1200px 800px at 10% -10%, #1c1c33 0%, #0b0b14 60%), var(--bg);}
    .wrap{max-width:900px; margin:28px auto; padding:0 14px;}
    h1{font-weight:800; margin:0 0 8px;}
    .subtitle{color:var(--muted); margin:10px 0 16px}
    .section{background:#17172b; border:1px solid rgba(255,255,255,.12); border-radius:var(--radius); padding:16px; margin-bottom:16px}
    label{display:block; margin:10px 0 6px; font-weight:600}
    input,select{width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.2); background:#1a1a33; color:var(--text)}
    .row{display:grid; grid-template-columns:1fr; gap:12px}
    @media(min-width:720px){.row{grid-template-columns:repeat(2,1fr)}}
    .actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
    .btn{background:#1a1a33; border:1px solid rgba(255,255,255,.16); color:var(--text); padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:600}
    .primary{background: linear-gradient(135deg, var(--accent2), var(--accent3)); color:#082019; border:none}
    .error{color:#ffd36b; font-size:12px; margin-top:6px}
    .hidden{display:none}
    /* Test UI */
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); border-radius:var(--radius); padding:14px; display:flex; gap:10px; align-items:center; cursor:pointer;}
    .card input{display:none}
    .card.selected{outline: 3px solid rgba(123,255,183,.65);}
    .emoji{font-size:26px}
    .title{font-weight:600}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#21213b; border:1px solid rgba(255,255,255,.1); font-size:12px; color:var(--muted)}
    .qcard{background: #121228; border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); padding:14px; margin:10px 0}
    .qtitle{font-weight:600; margin-bottom:8px}
    .options{display:flex; gap:8px; flex-wrap:wrap}
    .btn.opt{background:#1a1a33; border:1px solid rgba(255,255,255,.16); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600}
    .btn.opt[data-active="true"]{background: linear-gradient(135deg, var(--accent1), var(--accent3)); color:#0d0d14;}
    .panel{background:#0f0f22; border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); padding:14px}
    .legend{display:flex; flex-wrap:wrap; gap:10px; color:var(--muted)}
    .tag{background:#1b1b33; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.1)}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Lingua in prima schermata -->
    <div class="section">
      <label for="language" id="label-language">Lingua</label>
      <select id="language">
        <option value="it">Italiano</option><option value="en">English</option><option value="fr">FranÃ§ais</option>
        <option value="es">EspaÃ±ol</option><option value="de">Deutsch</option><option value="zh">ä¸­æ–‡</option><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      </select>
    </div>

    <h1 id="title">Test dei Desideri</h1>
    <div class="subtitle" id="intro-subtitle">Compila prima alcune informazioni sociodemografiche, poi accedi al test âœ¨</div>

    <!-- Sociodemografico -->
    <div id="socioDemo" class="section">
      <div class="row">
        <div><label id="label-age" for="age">EtÃ </label><input type="number" id="age" min="10" max="120" inputmode="numeric" pattern="[0-9]*"></div>
        <div>
          <label id="label-gender" for="gender">Genere</label>
          <select id="gender">
            <option value="female" data-i18n="gender.female">Donna</option>
            <option value="male" data-i18n="gender.male">Uomo</option>
            <option value="nb" data-i18n="gender.nb">Non binario</option>
            <option value="na" data-i18n="gender.na">Preferisco non rispondere</option>
          </select>
        </div>
        <div>
          <label id="label-education" for="education">Titolo di studio</label>
          <select id="education">
            <option value="elementary" data-i18n="edu.elementary">Elementari</option>
            <option value="middle" data-i18n="edu.middle">Medie</option>
            <option value="high" data-i18n="edu.high">Diploma</option>
            <option value="degree" data-i18n="edu.degree">Laurea</option>
            <option value="master" data-i18n="edu.master">Master/Dottorato</option>
            <option value="other" data-i18n="common.other">Altro</option>
          </select>
        </div>
        <div>
          <label id="label-job" for="job">Occupazione</label>
          <select id="job">
            <option value="student" data-i18n="job.student">Studente</option>
            <option value="unemployed" data-i18n="job.unemployed">Disoccupato</option>
            <option value="employee" data-i18n="job.employee">Lavoratore dipendente</option>
            <option value="self" data-i18n="job.self">Libero professionista</option>
            <option value="retired" data-i18n="job.retired">Pensionato</option>
            <option value="other" data-i18n="common.other">Altro</option>
          </select>
        </div>
        <div>
          <label id="label-status" for="status">Stato civile</label>
          <select id="status">
            <option value="single" data-i18n="status.single">Single</option>
            <option value="couple" data-i18n="status.couple">In coppia</option>
            <option value="married" data-i18n="status.married">Sposato/a</option>
            <option value="separated" data-i18n="status.separated">Separato/a</option>
            <option value="widowed" data-i18n="status.widowed">Vedovo/a</option>
          </select>
        </div>
        <div><label id="label-children" for="children">Numero di figli</label><input type="number" id="children" min="0" max="20" inputmode="numeric" pattern="[0-9]*"></div>
      </div>

      <label id="label-country" for="country" style="margin-top:10px;">Paese di residenza</label>
      <select id="country">
        <option value="IT">Italia</option><option value="FR">Francia</option><option value="DE">Germania</option>
        <option value="ES">Spagna</option><option value="GB">Regno Unito</option><option value="US">Stati Uniti</option>
        <option value="CN">Cina</option><option value="JP">Giappone</option><option value="BR">Brasile</option>
        <option value="AR">Argentina</option><option value="MX">Messico</option><option value="CA">Canada</option>
      </select>
      <div id="errorMsg" class="error"></div>

      <div class="actions">
        <button type="button" class="btn primary" id="startTest">Inizia il test</button>
      </div>
    </div>

    <!-- Test -->
    <div id="testSection" class="hidden">
      <div class="subtitle" id="phase-intro">Ora puoi iniziare a selezionare i tuoi desideri ðŸŒŸ</div>

      <div class="section">
        <div class="pill" id="phase1">Fase 1 Â· Seleziona i desideri</div>
        <div class="grid" id="desireGrid"></div>
        <div class="actions">
          <button type="button" class="btn" id="clearSelection">Reset</button>
          <button type="button" class="btn primary" id="toQuestions">Continua â†’</button>
        </div>
      </div>

      <div id="questions"></div>

      <div class="section" id="results" style="display:none">
        <div class="panel" style="margin-bottom:12px;">
          <canvas id="radar" height="420"></canvas>
        </div>
        <div class="panel">
          <div class="legend" id="legend"></div>
          <div class="actions" style="margin-top:12px;">
            <button type="button" class="btn" id="toggleMode">Mostra distanza (â†”ï¸Ž)</button>
            <button type="button" class="btn" id="downloadPNG">Scarica grafico</button>
          </div>
        </div>
      </div>

      <div class="subtitle" id="footer" style="margin-top:16px;">Nota: il punteggio Ã¨ una autovalutazione basata su 6 indicatori...</div>
    </div>
  </div>

<script>
let currentLang = 'it';
let selected = [];
let answers = {};
let radar, showDistance=false;

// I18N (UI+desideri+domande) â€“ le 6 lingue richieste
const I = {
  it:{ L:{language:"Lingua", title:"Test dei Desideri", intro:"Compila prima alcune informazioni sociodemografiche, poi accedi al test âœ¨", age:"EtÃ ", gender:"Genere", education:"Titolo di studio", job:"Occupazione", status:"Stato civile", children:"Numero di figli", country:"Paese di residenza", start:"Inizia il test", phaseIntro:"Ora puoi iniziare a selezionare i tuoi desideri ðŸŒŸ", phase1:"Fase 1 Â· Seleziona i desideri", reset:"Reset", cont:"Continua â†’", toggle:"Mostra distanza (â†”ï¸Ž)", download:"Scarica grafico", see:"Vedi risultati âœ¨", footer:"Nota: il punteggio Ã¨ una autovalutazione basata su 6 indicatori: chiarezza, azioni, risorse, supporto, ostacoli, controllo personale. Usalo come bussola, non come verdetto ðŸ˜Š", warn:"Per favore compila almeno etÃ " }, G:{female:"Donna", male:"Uomo", nb:"Non binario", na:"Preferisco non rispondere"}, E:{elementary:"Elementari", middle:"Medie", high:"Diploma", degree:"Laurea", master:"Master/Dottorato"}, J:{student:"Studente", unemployed:"Disoccupato", employee:"Lavoratore dipendente", self:"Libero professionista", retired:"Pensionato"}, S:{single:"Single", couple:"In coppia", married:"Sposato/a", separated:"Separato/a", widowed:"Vedovo/a"}, D:["ðŸ’¼ Successo professionale/lavorativo","ðŸš€ Realizzare un grande progetto personale","ðŸŒ Contribuire a un cambiamento sociale","ðŸ’˜ Amore autentico e stabile","ðŸ‘ª Relazioni familiari solide e armoniose","ðŸ¤ Amicizie profonde e durature","ðŸ§  Benessere fisico e mentale","ðŸ¡ Una casa accogliente/sicura","âœˆï¸ Viaggiare e scoprire il mondo","ðŸŽ­ Espressione creativa/artistica","ðŸ’¶ StabilitÃ  economica/finanziaria","ðŸ§­ LibertÃ  e indipendenza personale","âœ¨ Crescita interiore/spiritualitÃ ","ðŸ† Riconoscimento e realizzazione personale","ðŸ“– Apprendimento e crescita culturale","ðŸŒ„ Vivere esperienze nuove e avventurose"], Q:[{k:'clarity',t:'Quanto Ã¨ CHIARO il desiderio (specifico e misurabile)?',o:['Per nulla','Poco','Abbastanza','Molto','Cristallino'],inv:false},{k:'actions',t:'Stai AGENDO giÃ  ora per questo desiderio?',o:['No','Ogni tanto','1-2 azioni/mese','1-2 azioni/settimana','Azioni settimanali+'],inv:false},{k:'resources',t:'Hai RISORSE (tempo, competenze, denaro) sufficienti?',o:['Per nulla','Poche','Parziali','Quasi sufficienti','Sufficienti+'],inv:false},{k:'support',t:'Hai una RETE di supporto (persone/alleati)?',o:['Nessuna','Limitata','Qualche contatto','Buona rete','Rete forte'],inv:false},{k:'obstacles',t:'Gli OSTACOLI ti stanno frenando?',o:['Moltissimo','Molto','Qualche ostacolo','Pochi','Quasi zero'],inv:true},{k:'control',t:'Quanto DIPENDE DA TE (vs. fattori esterni)?',o:['Quasi nulla','Poco','MetÃ ','Molto','Quasi tutto'],inv:false}], R:{prob:"ProbabilitÃ  di realizzazione", dist:"Distanza dal traguardo"} },
  en:{ L:{language:"Language", title:"Dreams Test", intro:"Fill in some sociodemographic info, then start the test âœ¨", age:"Age", gender:"Gender", education:"Education", job:"Occupation", status:"Marital status", children:"Number of children", country:"Country of residence", start:"Start test", phaseIntro:"Now select your dreams ðŸŒŸ", phase1:"Step 1 Â· Select your dreams", reset:"Reset", cont:"Continue â†’", toggle:"Show distance (â†”ï¸Ž)", download:"Download chart", see:"See results âœ¨", footer:"Note: the score is a self-assessment based on 6 indicators: clarity, actions, resources, support, obstacles, personal control. Use it as a compass, not a verdict ðŸ˜Š", warn:"Please enter at least your age" }, G:{female:"Woman", male:"Man", nb:"Non-binary", na:"Prefer not to answer"}, E:{elementary:"Primary school", middle:"Middle school", high:"High school", degree:"Bachelor's degree", master:"Master/PhD"}, J:{student:"Student", unemployed:"Unemployed", employee:"Employee", self:"Self-employed", retired:"Retired"}, S:{single:"Single", couple:"In a relationship", married:"Married", separated:"Separated", widowed:"Widowed"}, D:["ðŸ’¼ Professional success","ðŸš€ Accomplish a major personal project","ðŸŒ Contribute to social change","ðŸ’˜ Authentic and stable love","ðŸ‘ª Strong and harmonious family relationships","ðŸ¤ Deep and lasting friendships","ðŸ§  Physical & mental wellbeing","ðŸ¡ A cozy/safe home","âœˆï¸ Travel and explore the world","ðŸŽ­ Creative/artistic expression","ðŸ’¶ Financial stability","ðŸ§­ Freedom and personal independence","âœ¨ Inner growth/spirituality","ðŸ† Recognition and selfâ€‘realization","ðŸ“– Learning and cultural growth","ðŸŒ„ New and adventurous experiences"], Q:[{k:'clarity',t:'How CLEAR is the dream (specific & measurable)?',o:['Not at all','A little','Somewhat','Very','Crystal clear'],inv:false},{k:'actions',t:'Are you ACTING on this dream already?',o:['No','Sometimes','1â€“2 actions/month','1â€“2 actions/week','Weekly+ actions'],inv:false},{k:'resources',t:'Do you have enough RESOURCES (time, skills, money)?',o:['Not at all','Few','Partial','Almost enough','Enough+'],inv:false},{k:'support',t:'Do you have a SUPPORT network (people/allies)?',o:['None','Limited','Some contacts','Good network','Strong network'],inv:false},{k:'obstacles',t:'Are OBSTACLES holding you back?',o:['Very much','A lot','Some','Few','Almost none'],inv:true},{k:'control',t:'How much depends on YOU (vs external factors)?',o:['Almost nothing','Little','Half','A lot','Almost all'],inv:false}], R:{prob:"Likelihood", dist:"Distance to goal"} },
  fr:{ L:{language:"Langue", title:"Test des DÃ©sirs", intro:"Renseignez d'abord quelques infos, puis commencez âœ¨", age:"Ã‚ge", gender:"Genre", education:"Ã‰tudes", job:"Occupation", status:"Ã‰tat civil", children:"Nombre dâ€™enfants", country:"Pays de rÃ©sidence", start:"Commencer", phaseIntro:"SÃ©lectionnez vos dÃ©sirs ðŸŒŸ", phase1:"Ã‰tape 1 Â· SÃ©lectionnez vos dÃ©sirs", reset:"RÃ©initialiser", cont:"Continuer â†’", toggle:"Afficher la distance (â†”ï¸Ž)", download:"TÃ©lÃ©charger le graphique", see:"Voir les rÃ©sultats âœ¨", footer:"AutoÃ©valuation basÃ©e sur 6 indicateurs : clartÃ©, actions, ressources, soutien, obstacles, contrÃ´le personnel. Boussole, pas verdict ðŸ˜Š", warn:"Indiquez au moins votre Ã¢ge" }, G:{female:"Femme", male:"Homme", nb:"Non binaire", na:"Je prÃ©fÃ¨re ne pas rÃ©pondre"}, E:{elementary:"Primaire", middle:"CollÃ¨ge", high:"LycÃ©e", degree:"Licence", master:"Master/Doctorat"}, J:{student:"Ã‰tudiant", unemployed:"Sans emploi", employee:"EmployÃ©", self:"IndÃ©pendant", retired:"RetraitÃ©"}, S:{single:"CÃ©libataire", couple:"En couple", married:"MariÃ©(e)", separated:"SÃ©parÃ©(e)", widowed:"Veuf/Veuve"}, D:["ðŸ’¼ RÃ©ussite professionnelle","ðŸš€ Mener un grand projet personnel","ðŸŒ Contribuer au changement social","ðŸ’˜ Amour authentique et stable","ðŸ‘ª Relations familiales harmonieuses","ðŸ¤ AmitiÃ©s profondes et durables","ðŸ§  Bienâ€‘Ãªtre physique et mental","ðŸ¡ Un foyer sÃ»r et chaleureux","âœˆï¸ Voyager et dÃ©couvrir le monde","ðŸŽ­ Expression crÃ©ative/artistique","ðŸ’¶ StabilitÃ© financiÃ¨re","ðŸ§­ LibertÃ© et indÃ©pendance personnelle","âœ¨ Croissance intÃ©rieure/spiritualitÃ©","ðŸ† Reconnaissance et accomplissement","ðŸ“– Apprentissage et culture","ðŸŒ„ Vivre de nouvelles aventures"], Q:[{k:'clarity',t:'Ce dÃ©sir estâ€‘il CLAIR (spÃ©cifique & mesurable) ?',o:['Pas du tout','Peu','Assez','Beaucoup','Cristallin'],inv:false},{k:'actions',t:'Agissezâ€‘vous dÃ©jÃ  ?',o:['Non','Parfois','1â€“2 actions/mois','1â€“2 actions/semaine','Hebdo+'],inv:false},{k:'resources',t:'Avezâ€‘vous des RESSOURCES suffisantes ?',o:['Pas du tout','Peu','Partielles','Presque suffisantes','Suffisantes+'],inv:false},{k:'support',t:'Avezâ€‘vous un RÃ‰SEAU de soutien ?',o:['Aucun','LimitÃ©','Quelques contacts','Bon rÃ©seau','RÃ©seau fort'],inv:false},{k:'obstacles',t:'Les OBSTACLES vous freinentâ€‘ils ?',o:['Ã‰normÃ©ment','Beaucoup','Un peu','Peu','Presque pas'],inv:true},{k:'control',t:'Quelle part dÃ©pend de VOUS ?',o:['Presque rien','Peu','MoitiÃ©','Beaucoup','Presque tout'],inv:false}], R:{prob:"ProbabilitÃ©", dist:"Distance"} },
  es:{ L:{language:"Idioma", title:"Test de los Deseos", intro:"Completa primero algunos datos y empieza âœ¨", age:"Edad", gender:"GÃ©nero", education:"EducaciÃ³n", job:"OcupaciÃ³n", status:"Estado civil", children:"NÃºmero de hijos", country:"PaÃ­s de residencia", start:"Empezar", phaseIntro:"Ahora selecciona tus deseos ðŸŒŸ", phase1:"Paso 1 Â· Selecciona tus deseos", reset:"Reiniciar", cont:"Continuar â†’", toggle:"Mostrar distancia (â†”ï¸Ž)", download:"Descargar grÃ¡fico", see:"Ver resultados âœ¨", footer:"AutoevaluaciÃ³n basada en 6 indicadores: claridad, acciones, recursos, apoyo, obstÃ¡culos, control personal. BrÃºjula, no veredicto ðŸ˜Š", warn:"Indica al menos tu edad" }, G:{female:"Mujer", male:"Hombre", nb:"No binario", na:"Prefiero no responder"}, E:{elementary:"Primaria", middle:"Secundaria bÃ¡sica", high:"Bachillerato", degree:"Grado", master:"MÃ¡ster/Doctorado"}, J:{student:"Estudiante", unemployed:"Desempleado", employee:"Empleado", self:"AutÃ³nomo", retired:"Jubilado"}, S:{single:"Soltero/a", couple:"En pareja", married:"Casado/a", separated:"Separado/a", widowed:"Viudo/a"}, D:["ðŸ’¼ Ã‰xito profesional","ðŸš€ Realizar un gran proyecto personal","ðŸŒ Contribuir al cambio social","ðŸ’˜ Amor autÃ©ntico y estable","ðŸ‘ª Relaciones familiares sÃ³lidas","ðŸ¤ Amistades profundas y duraderas","ðŸ§  Bienestar fÃ­sico y mental","ðŸ¡ Un hogar seguro y acogedor","âœˆï¸ Viajar y explorar el mundo","ðŸŽ­ ExpresiÃ³n creativa/artÃ­stica","ðŸ’¶ Estabilidad financiera","ðŸ§­ Libertad e independencia personal","âœ¨ Crecimiento interior/espiritualidad","ðŸ† Reconocimiento y autorrealizaciÃ³n","ðŸ“– Aprendizaje y crecimiento cultural","ðŸŒ„ Nuevas experiencias aventureras"], Q:[{k:'clarity',t:'Â¿QuÃ© tan CLARO es el deseo (especÃ­fico y medible)?',o:['Nada','Poco','Algo','Mucho','ClarÃ­simo'],inv:false},{k:'actions',t:'Â¿Ya estÃ¡s ACTUANDO en este deseo?',o:['No','A veces','1â€“2/mes','1â€“2/semana','Semanal+'],inv:false},{k:'resources',t:'Â¿Tienes RECURSOS suficientes?',o:['Nada','Pocos','Parciales','Casi suficientes','Suficientes+'],inv:false},{k:'support',t:'Â¿Tienes una RED de apoyo?',o:['Ninguna','Limitada','Algunos contactos','Buena red','Red fuerte'],inv:false},{k:'obstacles',t:'Â¿Los OBSTÃCULOS te frenan?',o:['MuchÃ­simo','Mucho','Algo','Poco','Casi nada'],inv:true},{k:'control',t:'Â¿CuÃ¡nto depende de TI?',o:['Casi nada','Poco','La mitad','Mucho','Casi todo'],inv:false}], R:{prob:"Probabilidad", dist:"Distancia"} },
  de:{ L:{language:"Sprache", title:"Wunschtest", intro:"Zuerst ein paar Angaben, dann los âœ¨", age:"Alter", gender:"Geschlecht", education:"Bildung", job:"BeschÃ¤ftigung", status:"Familienstand", children:"Anzahl der Kinder", country:"Wohnsitzland", start:"Test starten", phaseIntro:"WÃ¤hle deine WÃ¼nsche ðŸŒŸ", phase1:"Schritt 1 Â· WÃ¤hle deine WÃ¼nsche", reset:"ZurÃ¼cksetzen", cont:"Weiter â†’", toggle:"Distanz anzeigen (â†”ï¸Ž)", download:"Diagramm herunterladen", see:"Ergebnisse anzeigen âœ¨", footer:"SelbsteinschÃ¤tzung auf Basis von 6 Indikatoren ... Kompass, kein Urteil ðŸ˜Š", warn:"Bitte gib mindestens dein Alter an" }, G:{female:"Frau", male:"Mann", nb:"Nicht-binÃ¤r", na:"Keine Angabe"}, E:{elementary:"Grundschule", middle:"Mittelschule", high:"Abitur", degree:"Bachelor", master:"Master/Promotion"}, J:{student:"Student", unemployed:"Arbeitslos", employee:"Angestellt", self:"SelbststÃ¤ndig", retired:"Ruhestand"}, S:{single:"Ledig", couple:"In Beziehung", married:"Verheiratet", separated:"Getrennt", widowed:"Verwitwet"}, D:["ðŸ’¼ Beruflicher Erfolg","ðŸš€ GroÃŸes persÃ¶nliches Projekt","ðŸŒ Gesellschaftlichen Wandel unterstÃ¼tzen","ðŸ’˜ Authentische, stabile Liebe","ðŸ‘ª Starke Familienbeziehungen","ðŸ¤ Tiefe Freundschaften","ðŸ§  KÃ¶rperliches & mentales Wohlbefinden","ðŸ¡ Ein sicheres Zuhause","âœˆï¸ Reisen & die Welt entdecken","ðŸŽ­ Kreative/kÃ¼nstlerische Entfaltung","ðŸ’¶ Finanzielle StabilitÃ¤t","ðŸ§­ Freiheit & persÃ¶nliche UnabhÃ¤ngigkeit","âœ¨ Innere Entwicklung/SpiritualitÃ¤t","ðŸ† Anerkennung & Selbstverwirklichung","ðŸ“– Lernen & kulturelles Wachstum","ðŸŒ„ Neue, abenteuerliche Erfahrungen"], Q:[{k:'clarity',t:'Wie KLAR ist der Wunsch (spezifisch & messbar)?',o:['Gar nicht','Wenig','Etwas','Sehr','Kristallklar'],inv:false},{k:'actions',t:'Arbeitest du bereits daran?',o:['Nein','Manchmal','1â€“2/Monat','1â€“2/Woche','WÃ¶chentlich+'],inv:false},{k:'resources',t:'Hast du genÃ¼gend RESSOURCEN?',o:['Gar nicht','Wenig','Teilweise','Fast genug','Genug+'],inv:false},{k:'support',t:'Hast du ein UNTERSTÃœTZUNGSnetz?',o:['Keins','Begrenzt','Einige Kontakte','Gutes Netz','Starkes Netz'],inv:false},{k:'obstacles',t:'Halten dich HINDERNISSE auf?',o:['Sehr','Stark','Etwas','Wenig','Kaum'],inv:true},{k:'control',t:'Wieviel hÃ¤ngt von DIR ab?',o:['Fast nichts','Wenig','Zur HÃ¤lfte','Viel','Fast alles'],inv:false}], R:{prob:"Wahrscheinlichkeit", dist:"Distanz"} },
  zh:{ L:{language:"è¯­è¨€", title:"æ„¿æœ›æµ‹è¯•", intro:"å…ˆå¡«å†™ä¸€äº›ä¿¡æ¯ï¼Œç„¶åŽå¼€å§‹æµ‹è¯• âœ¨", age:"å¹´é¾„", gender:"æ€§åˆ«", education:"æ•™è‚²ç¨‹åº¦", job:"èŒä¸š", status:"å©šå§»çŠ¶å†µ", children:"å­å¥³æ•°é‡", country:"å±…ä½å›½å®¶", start:"å¼€å§‹æµ‹è¯•", phaseIntro:"çŽ°åœ¨é€‰æ‹©ä½ çš„æ„¿æœ› ðŸŒŸ", phase1:"æ­¥éª¤ 1 Â· é€‰æ‹©ä½ çš„æ„¿æœ›", reset:"é‡ç½®", cont:"ç»§ç»­ â†’", toggle:"æ˜¾ç¤ºè·ç¦» (â†”ï¸Ž)", download:"ä¸‹è½½å›¾è¡¨", see:"æŸ¥çœ‹ç»“æžœ âœ¨", footer:"è¿™æ˜¯åŸºäºŽ6ä¸ªæŒ‡æ ‡çš„è‡ªæˆ‘è¯„ä¼°â€¦ ðŸ˜Š", warn:"è¯·è‡³å°‘å¡«å†™å¹´é¾„" }, G:{female:"å¥³æ€§", male:"ç”·æ€§", nb:"éžäºŒå…ƒ", na:"ä¸æ„¿å›žç­”"}, E:{elementary:"å°å­¦", middle:"åˆä¸­", high:"é«˜ä¸­", degree:"æœ¬ç§‘", master:"ç¡•å£«/åšå£«"}, J:{student:"å­¦ç”Ÿ", unemployed:"å¤±ä¸š", employee:"é›‡å‘˜", self:"è‡ªç”±èŒä¸š", retired:"é€€ä¼‘"}, S:{single:"å•èº«", couple:"æ‹çˆ±ä¸­", married:"å·²å©š", separated:"åˆ†å±…", widowed:"ä¸§å¶"}, D:["ðŸ’¼ èŒä¸šæˆåŠŸ","ðŸš€ é‡è¦ä¸ªäººé¡¹ç›®","ðŸŒ ç¤¾ä¼šå˜é©è´¡çŒ®","ðŸ’˜ çœŸå®žç¨³å®šçš„çˆ±","ðŸ‘ª å’Œè°çš„å®¶åº­å…³ç³»","ðŸ¤ æ·±åŽšæŒä¹…çš„å‹è°Š","ðŸ§  èº«å¿ƒå¥åº·","ðŸ¡ å®‰å…¨èˆ’é€‚çš„å®¶","âœˆï¸ æ—…è¡ŒæŽ¢ç´¢ä¸–ç•Œ","ðŸŽ­ åˆ›æ„/è‰ºæœ¯è¡¨è¾¾","ðŸ’¶ è´¢åŠ¡ç¨³å®š","ðŸ§­ è‡ªç”±ä¸Žç‹¬ç«‹","âœ¨ å†…åœ¨æˆé•¿/çµæ€§","ðŸ† è®¤å¯ä¸Žè‡ªæˆ‘å®žçŽ°","ðŸ“– å­¦ä¹ ä¸Žæ–‡åŒ–æˆé•¿","ðŸŒ„ å†’é™©æ–°ä½“éªŒ"], Q:[{k:'clarity',t:'æ„¿æœ›æ˜¯å¦æ¸…æ™°ï¼ˆå…·ä½“ä¸”å¯è¡¡é‡ï¼‰ï¼Ÿ',o:['å®Œå…¨ä¸','æœ‰ç‚¹','ä¸€èˆ¬','å¾ˆæ¸…æ™°','éžå¸¸æ¸…æ™°'],inv:false},{k:'actions',t:'ä½ æ˜¯å¦å·²ç»åœ¨ä¸ºæ­¤è¡ŒåŠ¨ï¼Ÿ',o:['æ²¡æœ‰','å¶å°”','æ¯æœˆ1â€“2æ¬¡','æ¯å‘¨1â€“2æ¬¡','æ¯å‘¨å¤šæ¬¡'],inv:false},{k:'resources',t:'èµ„æºæ˜¯å¦å……è¶³ï¼Ÿ',o:['å®Œå…¨ä¸','è¾ƒå°‘','éƒ¨åˆ†','æŽ¥è¿‘è¶³å¤Ÿ','è¶³å¤Ÿ+'],inv:false},{k:'support',t:'æ˜¯å¦æœ‰æ”¯æŒç½‘ç»œï¼Ÿ',o:['æ²¡æœ‰','æœ‰é™','ä¸€äº›','è‰¯å¥½','å¼ºå¤§'],inv:false},{k:'obstacles',t:'éšœç¢æ˜¯å¦é˜»ç¢ä½ ï¼Ÿ',o:['éžå¸¸å¤š','å¾ˆå¤š','ä¸€äº›','è¾ƒå°‘','å‡ ä¹Žæ²¡æœ‰'],inv:true},{k:'control',t:'æœ‰å¤šå°‘å–å†³äºŽä½ ï¼Ÿ',o:['å‡ ä¹Žæ²¡æœ‰','å¾ˆå°‘','ä¸€åŠ','å¾ˆå¤š','å‡ ä¹Žå…¨éƒ¨'],inv:false}], R:{prob:"å®žçŽ°æ¦‚çŽ‡", dist:"è·ç¦»ç›®æ ‡"} },
  ar:{ L:{language:"Ø§Ù„Ù„ØºØ©", title:"Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª", intro:"Ø§Ù…Ù„Ø£ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¨Ø¯Ø£ âœ¨", age:"Ø§Ù„Ø¹Ù…Ø±", gender:"Ø§Ù„Ù†ÙˆØ¹", education:"Ø§Ù„ØªØ¹Ù„ÙŠÙ…", job:"Ø§Ù„Ø¹Ù…Ù„", status:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©", children:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„", country:"Ø¨Ù„Ø¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©", start:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", phaseIntro:"Ø§Ø®ØªØ± Ø£Ù…Ù†ÙŠØ§ØªÙƒ Ø§Ù„Ø¢Ù† ðŸŒŸ", phase1:"Ø§Ù„Ø®Ø·ÙˆØ© 1 Â· Ø§Ø®ØªØ± Ø£Ù…Ù†ÙŠØ§ØªÙƒ", reset:"Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†", cont:"Ù…ØªØ§Ø¨Ø¹Ø© â†’", toggle:"Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø³Ø§ÙØ© (â†”ï¸Ž)", download:"ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø±Ø³Ù…", see:"Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ âœ¨", footer:"ØªÙ‚ÙŠÙŠÙ… Ø°Ø§ØªÙŠ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ 6 Ù…Ø¤Ø´Ø±Ø§Øªâ€¦ ðŸ˜Š", warn:"ÙŠÙØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù…Ø±" }, G:{female:"Ø§Ù…Ø±Ø£Ø©", male:"Ø±Ø¬Ù„", nb:"ØºÙŠØ± Ø«Ù†Ø§Ø¦ÙŠ", na:"Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©"}, E:{elementary:"Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", middle:"Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", high:"Ø«Ø§Ù†ÙˆÙŠ", degree:"Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³", master:"Ù…Ø§Ø¬Ø³ØªÙŠØ±/Ø¯ÙƒØªÙˆØ±Ø§Ù‡"}, J:{student:"Ø·Ø§Ù„Ø¨", unemployed:"Ø¹Ø§Ø·Ù„", employee:"Ù…ÙˆØ¸Ù", self:"Ø¹Ù…Ù„ Ø­Ø±", retired:"Ù…ØªÙ‚Ø§Ø¹Ø¯"}, S:{single:"Ø£Ø¹Ø²Ø¨", couple:"Ù…Ø±ØªØ¨Ø·", married:"Ù…ØªØ²ÙˆØ¬", separated:"Ù…Ù†ÙØµÙ„", widowed:"Ø£Ø±Ù…Ù„"}, D:["ðŸ’¼ Ù†Ø¬Ø§Ø­ Ù…Ù‡Ù†ÙŠ","ðŸš€ Ù…Ø´Ø±ÙˆØ¹ Ø´Ø®ØµÙŠ ÙƒØ¨ÙŠØ±","ðŸŒ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ","ðŸ’˜ Ø­Ø¨ Ø£ØµÙŠÙ„ ÙˆÙ…Ø³ØªÙ‚Ø±","ðŸ‘ª Ø¹Ù„Ø§Ù‚Ø§Øª Ø£Ø³Ø±ÙŠØ© Ù…ØªÙŠÙ†Ø©","ðŸ¤ ØµØ¯Ø§Ù‚Ø§Øª Ø¹Ù…ÙŠÙ‚Ø© ÙˆØ¯Ø§Ø¦Ù…Ø©","ðŸ§  ØµØ­Ø© Ù†ÙØ³ÙŠØ© ÙˆØ¬Ø³Ø¯ÙŠØ©","ðŸ¡ Ù…Ù†Ø²Ù„ Ø¢Ù…Ù† ÙˆØ¯Ø§ÙØ¦","âœˆï¸ Ø§Ù„Ø³ÙØ± ÙˆØ§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¹Ø§Ù„Ù…","ðŸŽ­ ØªØ¹Ø¨ÙŠØ± Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ/ÙÙ†ÙŠ","ðŸ’¶ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù…Ø§Ù„ÙŠ","ðŸ§­ Ø­Ø±ÙŠØ© ÙˆØ§Ø³ØªÙ‚Ù„Ø§Ù„ Ø´Ø®ØµÙŠ","âœ¨ Ù†Ù…Ùˆ Ø¯Ø§Ø®Ù„ÙŠ/Ø±ÙˆØ­Ø§Ù†ÙŠ","ðŸ† Ø§Ø¹ØªØ±Ø§Ù ÙˆØªØ­Ù‚ÙŠÙ‚ Ø°Ø§Øª","ðŸ“– ØªØ¹Ù„Ù… ÙˆÙ†Ù…Ùˆ Ø«Ù‚Ø§ÙÙŠ","ðŸŒ„ ØªØ¬Ø§Ø±Ø¨ Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…ØºØ§Ù…Ø±Ø©"], Q:[{k:'clarity',t:'Ù…Ø§ Ù…Ø¯Ù‰ ÙˆØ¶ÙˆØ­ Ø§Ù„Ø£Ù…Ù†ÙŠØ©ØŸ',o:['Ù„Ø§ Ø´ÙŠØ¡','Ù‚Ù„ÙŠÙ„','Ù…ØªÙˆØ³Ø·','ÙƒØ¨ÙŠØ±','ÙˆØ§Ø¶Ø­ Ø¬Ø¯Ù‹Ø§'],inv:false},{k:'actions',t:'Ù‡Ù„ ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ù…Ù†ÙŠØ©ØŸ',o:['Ù„Ø§','Ø£Ø­ÙŠØ§Ù†Ù‹Ø§','1â€“2/Ø´Ù‡Ø±','1â€“2/Ø£Ø³Ø¨ÙˆØ¹','Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§+'],inv:false},{k:'resources',t:'Ù‡Ù„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙƒØ§ÙÙŠØ©ØŸ',o:['Ù„Ø§','Ù‚Ù„ÙŠÙ„','Ø¬Ø²Ø¦ÙŠ','ÙŠÙƒØ§Ø¯ ÙŠÙƒÙÙŠ','ÙŠÙƒÙÙŠ+'],inv:false},{k:'support',t:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø´Ø¨ÙƒØ© Ø¯Ø¹Ù…ØŸ',o:['Ù„Ø§','Ù…Ø­Ø¯ÙˆØ¯Ø©','Ø¨Ø¹Ø¶ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª','Ø´Ø¨ÙƒØ© Ø¬ÙŠØ¯Ø©','Ø´Ø¨ÙƒØ© Ù‚ÙˆÙŠØ©'],inv:false},{k:'obstacles',t:'Ù‡Ù„ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚ ØªØ¹Ø±Ù‚Ù„ ØªÙ‚Ø¯Ù…ÙƒØŸ',o:['Ø¬Ø¯Ø§Ù‹','ÙƒØ«ÙŠØ±Ø§Ù‹','Ø¨Ø¹Ø¶ Ø§Ù„Ø´ÙŠØ¡','Ù‚Ù„ÙŠÙ„','ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù„Ø§'],inv:true},{k:'control',t:'ÙƒÙ… ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø£Ù…Ø± Ø¹Ù„ÙŠÙƒØŸ',o:['ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù„Ø§','Ù‚Ù„ÙŠÙ„','Ø§Ù„Ù†ØµÙ','ÙƒØ«ÙŠØ±','ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ ÙƒÙ„ Ø´ÙŠØ¡'],inv:false}], R:{prob:"Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„", dist:"Ø§Ù„Ù…Ø³Ø§ÙØ©"} }
};

const KEYS = ['lavoro','progetto','impatto','amore','famiglia','amici','benessere','casa','viaggi','arte','soldi','indipendenza','spiritualita','riconoscimento','conoscenza','avventura'];

function t(){ return I[currentLang]; }

// Apply language to all UI
function applyLang(){
  document.documentElement.lang = currentLang;
  const L = t().L;
  // labels
  document.getElementById('label-language').innerText = L.language;
  document.getElementById('title').innerText = L.title;
  document.getElementById('intro-subtitle').innerText = L.intro;
  document.getElementById('label-age').innerText = L.age;
  document.getElementById('label-gender').innerText = L.gender;
  document.getElementById('label-education').innerText = L.education;
  document.getElementById('label-job').innerText = L.job;
  document.getElementById('label-status').innerText = L.status;
  document.getElementById('label-children').innerText = L.children;
  document.getElementById('label-country').innerText = L.country;
  document.getElementById('startTest').innerText = L.start;
  document.getElementById('phase-intro').innerText = L.phaseIntro;
  document.getElementById('phase1').innerText = L.phase1;
  document.getElementById('clearSelection').innerText = L.reset;
  document.getElementById('toQuestions').innerText = L.cont;
  document.getElementById('toggleMode').innerText = L.toggle;
  document.getElementById('downloadPNG').innerText = L.download;
  document.getElementById('footer').innerText = L.footer;

  // translate dropdown options with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const path = el.getAttribute('data-i18n').split('.'); // e.g. gender.female
    let node = I[currentLang];
    for(const p of path){ node = node && node[p]; }
    if(node){ el.textContent = node; }
  });

  // rebuild desires grid
  buildDesires();
  // if questions already visible, rebuild them in new language
  if (document.getElementById('questions').children.length) renderQuestions();
}

function buildDesires(){
  const grid = document.getElementById('desireGrid');
  grid.innerHTML = '';
  t().D.forEach((label, idx)=> addCard(grid, KEYS[idx], label));
  selected = []; // reset selection to avoid mismatches across languages
  answers = {};
  document.getElementById('questions').innerHTML='';
  document.getElementById('results').style.display='none';
}

function addCard(parent, key, label){
  const card = document.createElement('label');
  card.className = 'card';
  card.innerHTML = `<input type="checkbox" data-key="${key}"><div class="emoji">${label.split(' ')[0]}</div><div class="title">${label.substring(2)}</div>`;
  parent.appendChild(card);
  const input = card.querySelector('input');
  input.addEventListener('change', (e) => {
    if (e.target.checked) {
      if (selected.length >= 8) { e.target.checked = false; return; }
      selected.push(key); card.classList.add('selected');
    } else { selected = selected.filter(k => k!==key); card.classList.remove('selected'); }
  });
}

function renderQuestions(){
  const holder = document.getElementById('questions');
  holder.innerHTML = '';
  const Q = t().Q;

  selected.forEach((key,i)=>{
    const el = document.querySelector(`input[data-key="${key}"]`).parentElement;
    const label = el.querySelector('.emoji').textContent + ' ' + el.querySelector('.title').textContent;
    const block = document.createElement('div');
    block.className = 'qcard';
    block.innerHTML = `<div class="qtitle">${i+1}. ${label}</div>`;

    Q.forEach(q => {
      const row = document.createElement('div');
      row.style.margin = '10px 0 14px';
      row.innerHTML = `<div style="margin-bottom:6px; color:var(--muted)">${q.t}</div>`;
      const opts = document.createElement('div');
      opts.className = 'options';
      q.o.forEach((lab, idx)=>{
        const b = document.createElement('button');
        b.className = 'btn opt'; b.textContent = lab; b.setAttribute('data-active','false');
        b.onclick = ()=>{
          [...opts.children].forEach(el=>el.setAttribute('data-active','false'));
          b.setAttribute('data-active','true');
          if (!answers[key]) answers[key] = {};
          answers[key][q.k] = idx;
        };
        opts.appendChild(b);
      });
      row.appendChild(opts); block.appendChild(row);
    });

    holder.appendChild(block);
  });

  const go = document.createElement('div');
  go.className = 'actions';
  go.innerHTML = `<button type="button" class="btn primary" id="seeResults">${t().L.see}</button>`;
  holder.appendChild(go);
  document.getElementById('seeResults').onclick = computeAndShow;
}

function computeScoreFor(desireKey){
  const a = answers[desireKey] || {};
  const Q = t().Q;
  let sum = 0, max = 0;
  Q.forEach(q=>{
    const v = (a[q.k] ?? 0);
    const val = q.inv ? (4 - v) : v;
    sum += (val/4);
    max += 1;
  });
  const ratio = (max? sum/max : 0);
  return Math.round(ratio*100);
}

function computeAndShow(){
  const Q = t().Q;
  for(const k of selected){
    if(!answers[k] || Object.keys(answers[k]).length < Q.length){
      alert(t().L.warn);
      return;
    }
  }
  const labels = selected.map(k => {
    const el = document.querySelector(`input[data-key="${k}"]`).parentElement;
    return el.querySelector('.emoji').textContent + ' ' + el.querySelector('.title').textContent;
  });
  const scores = selected.map(k => computeScoreFor(k));
  const dataToPlot = showDistance ? scores.map(s=>100-s) : scores;

  const legend = document.getElementById('legend');
  legend.innerHTML = '';
  selected.forEach((k,i)=>{
    const chip = document.createElement('div');
    chip.className = 'tag';
    chip.textContent = `${labels[i]} â†’ ${showDistance? (100-scores[i]) : scores[i]}%`;
    legend.appendChild(chip);
  });

  document.getElementById('results').style.display = '';

  const ctx = document.getElementById('radar');
  if (radar) radar.destroy();
  radar = new Chart(ctx, {
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: showDistance? t().R.dist : t().R.prob,
        data: dataToPlot,
        fill: true,
        backgroundColor: 'rgba(123,255,183,0.25)',
        borderColor: 'rgba(122,199,255,1)',
        pointBackgroundColor: '#ffffff',
        pointBorderColor: 'rgba(255,255,255,.6)',
        pointRadius: 4,
        borderWidth: 3,
      }]
    },
    options: {
      responsive: true,
      scales: { r: { suggestedMin:0, suggestedMax:100, grid:{color:'rgba(255,255,255,.1)'}, angleLines:{color:'rgba(255,255,255,.15)'}, pointLabels:{color:'#eaeaf6', font:{size:12, weight:'600'}}, ticks:{display:true, color:'#bfbfdf', backdropColor:'transparent', stepSize:20} } },
      plugins: { legend:{ labels:{ color:'#eaeaf6' } } }
    }
  });
}

// Event wiring
document.getElementById('language').addEventListener('change', e=>{
  currentLang = e.target.value;
  applyLang();
});

document.getElementById('startTest').addEventListener('click', ()=>{
  const age = document.getElementById('age').value.trim();
  if(!age){
    document.getElementById('errorMsg').textContent = t().L.warn;
  } else {
    document.getElementById('errorMsg').textContent = '';
  }
  // Procede comunque al test anche se mancano campi, per evitare blocchi su mobile
  document.getElementById('socioDemo').classList.add('hidden');
  document.getElementById('testSection').classList.remove('hidden');
  window.scrollTo({top:0, behavior:'smooth'});
  applyLang(); // per assicurare traduzione anche nella schermata test
});

document.getElementById('clearSelection').addEventListener('click', ()=>{
  selected = []; answers = {};
  document.querySelectorAll('#desireGrid input').forEach(i=>{i.checked=false; i.closest('.card').classList.remove('selected');});
  document.getElementById('questions').innerHTML='';
  document.getElementById('results').style.display='none';
});

document.getElementById('toQuestions').addEventListener('click', ()=>{
  if (!selected.length) { alert(t().L.warn); return; }
  renderQuestions();
  window.scrollTo({top: document.getElementById('questions').offsetTop - 10, behavior:'smooth'});
});

document.getElementById('toggleMode').addEventListener('click', ()=>{
  showDistance = !showDistance;
  computeAndShow();
});

document.getElementById('downloadPNG').addEventListener('click', ()=>{
  const link = document.createElement('a');
  link.download = 'radar_desideri.png';
  link.href = document.getElementById('radar').toDataURL('image/png');
  link.click();
});

// Init
applyLang();
buildDesires();
</script>
</body>
</html>
